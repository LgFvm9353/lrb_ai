# VibeStory - AI驱动的互动故事生成器

一个基于AI的互动故事生成平台，支持关键词驱动的故事创作、智能音频配乐和移动端适配。

## 📋 项目概述

VibeStory是一个创新的互动小说平台，通过关键词驱动故事生成，结合智能音频系统和沉浸式用户体验，让用户创造属于自己的独特故事。

## 🔧 代码检查结果

### ✅ 已修复的问题

1. **故事树初始化问题**
   - 修复了 `currentStory.storyTree.rootNodeId` 未定义的问题
   - 确保故事树正确初始化根节点

2. **缺失的HTML元素引用**
   - 移除了对不存在的 `background-select` 元素的引用
   - 修复了 `detectSceneBackground` 函数中的元素检查

3. **进度条元素检查**
   - 添加了对不存在进度条元素的安全检查
   - 避免因缺失元素导致的JavaScript错误

4. **音频资源问题**
   - 将所有音频URL替换为base64编码的占位符
   - 避免因外部资源不可用导致的加载失败

5. **API密钥安全**
   - 移除了硬编码的API密钥
   - 改为用户运行时输入，提高安全性

6. **CSS样式补充**
   - 添加了缺失的 `skeleton-loading` 相关样式
   - 添加了进度条、音乐控制等组件的样式

### ⚠️ 仍需注意的问题

1. **API密钥配置**
   - 用户需要在使用前设置自己的DeepSeek API密钥
   - 首次运行时会提示输入API密钥

2. **音频资源**
   - 当前使用占位符音频，实际使用时需要替换为真实的音频文件
   - 建议使用本地音频文件或可靠的CDN资源

3. **性能优化**
   - 大量音频预加载可能影响初始加载速度
   - 建议根据实际需求调整预加载策略

## 🚀 功能特性

### 核心功能
- **关键词驱动故事生成** - 基于用户输入的关键词创建个性化故事
- **智能分支系统** - 预生成故事分支，提供流畅的交互体验
- **动态背景切换** - 根据故事内容自动切换场景背景
- **智能音频系统** - 根据故事主题和内容播放相应音乐和音效

### 用户体验
- **响应式设计** - 支持桌面和移动设备
- **沉浸式界面** - 现代化的游戏风格UI设计
- **实时进度显示** - 故事生成进度可视化
- **音频控制** - 完整的音频设置和控制功能

### 技术特性
- **性能优化** - 虚拟滚动、懒加载、缓存机制
- **错误处理** - 完善的错误处理和重试机制
- **本地存储** - 故事树缓存和设置保存
- **模块化架构** - 清晰的代码结构和组件分离

## 📁 项目结构

```
VibeStory/
├── index.html          # 主页面文件
├── script.js           # 核心JavaScript逻辑
├── style.css           # 样式文件
└── README.md           # 项目说明文档
```

## 🛠️ 技术栈

- **前端**: HTML5, CSS3, JavaScript (ES6+)
- **API**: DeepSeek API (AI故事生成)
- **音频**: Web Audio API
- **存储**: LocalStorage
- **性能**: 虚拟滚动、懒加载、缓存

## 🎮 使用说明

1. **设置API密钥**
   - 首次运行时输入DeepSeek API密钥
   - 或修改 `script.js` 中的 `API_CONFIG.apiKey`

2. **创建故事**
   - 输入关键词（用+连接多个关键词）
   - 选择难度和风格
   - 点击"开始故事"

3. **交互体验**
   - 阅读故事内容
   - 选择不同的选项分支
   - 享受智能音频和背景效果

4. **音频控制**
   - 调整主音量
   - 开关背景音乐、环境音效、界面音效
   - 使用音乐控制按钮

## 🔧 开发说明

### 主要类和模块

- **AudioManager** - 音频系统管理
- **PerformanceManager** - 性能优化管理
- **StoryNode** - 故事节点数据结构
- **storyTreeCache** - 故事树缓存管理

### 关键函数

- `generateStory()` - 故事生成主函数
- `makeChoice()` - 用户选择处理
- `displayStory()` - 故事内容显示
- `updateBackgroundByType()` - 背景切换

## 🐛 已知问题

1. **音频资源** - 当前使用占位符，需要替换为真实音频
2. **API限制** - 依赖外部API，需要稳定的网络连接
3. **浏览器兼容性** - 某些新特性可能不支持旧版浏览器

## 📝 更新日志

### v1.0.1 (当前版本)
- 修复故事树初始化问题
- 移除对不存在HTML元素的引用
- 添加缺失的CSS样式
- 修复音频资源加载问题
- 提高代码安全性

### v1.0.0
- 初始版本发布
- 基础故事生成功能
- 音频系统集成
- 响应式UI设计

## 🤝 贡献指南

欢迎提交Issue和Pull Request来改进项目！

## 📄 许可证

MIT License

---

**注意**: 使用前请确保已正确配置API密钥，并了解相关API的使用条款和限制。

## 🎵 新增功能

### 音频系统
- **背景音乐**: 根据故事风格自动播放相应的背景音乐
- **环境音效**: 根据场景背景播放环境音效（森林、城市、太空等）
- **界面音效**: 按钮点击、页面切换、选择确认等交互音效
- **音频控制**: 完整的音频控制面板，支持静音、音量调节、独立开关

### 性能优化
- **虚拟滚动**: 大量选项时的性能优化
- **懒加载**: 图片和组件的按需加载
- **资源预加载**: 关键资源的预加载机制
- **缓存系统**: 智能缓存管理，提升响应速度
- **硬件加速**: CSS硬件加速优化
- **内存管理**: 自动清理过期缓存和资源

## 🚀 主要特点

### 核心功能
- **关键词驱动**: 只需输入几个关键词，即可生成完整故事
- **智能分支**: 基于AI的故事树生成，支持多路径选择
- **动态背景**: 根据故事内容自动切换场景背景
- **响应式设计**: 完美适配桌面端和移动端

### 交互体验
- **流畅动画**: 现代化的UI动画效果
- **实时反馈**: 即时的用户操作反馈
- **进度显示**: 故事生成进度可视化
- **错误处理**: 完善的错误处理和重试机制

### 技术特色
- **模块化架构**: 清晰的代码结构，易于维护和扩展
- **性能优化**: 多层次的性能优化策略
- **音频集成**: 完整的Web Audio API集成
- **本地存储**: 智能的本地数据缓存

## 🎮 使用方法

### 1. 创建故事
1. 输入关键词（用+连接），如：`末日废墟+机械义肢+失忆`
2. 选择故事风格：冒险、科幻、奇幻、悬疑、浪漫
3. 设置难度等级（1-5级）
4. 选择背景场景（可选）
5. 点击"开始故事"

### 2. 音频控制
- **静音/取消静音**: 点击🔊按钮
- **音量调节**: 拖动音量滑块
- **音频设置**: 点击⚙️按钮打开设置面板
  - 背景音乐开关
  - 环境音效开关
  - 界面音效开关

### 3. 游戏界面
- **故事内容**: 查看当前故事段落
- **选择选项**: 点击选项继续故事
- **侧边栏**: 查看故事结构、角色关系等信息
- **导出功能**: 导出完整故事文本

## 🛠️ 技术栈

### 前端技术
- **HTML5**: 语义化结构
- **CSS3**: 现代化样式，动画效果
- **JavaScript ES6+**: 模块化开发
- **Web Audio API**: 音频处理
- **Intersection Observer**: 懒加载实现

### 性能优化
- **虚拟滚动**: 大量数据渲染优化
- **懒加载**: 按需加载资源
- **缓存策略**: 智能缓存管理
- **硬件加速**: CSS 3D变换
- **内存管理**: 自动资源清理

### 音频系统
- **背景音乐**: 根据故事风格动态切换
- **环境音效**: 场景相关的环境音效
- **界面音效**: 用户交互反馈音效
- **音频控制**: 完整的音频管理界面

## 📱 响应式支持

- **桌面端**: 完整功能体验
- **平板端**: 优化的触摸交互
- **移动端**: 简化的界面布局
- **高对比度**: 无障碍访问支持
- **减少动画**: 尊重用户偏好设置

## 🔧 配置说明

### API配置
```javascript
const API_CONFIG = {
    url: 'https://api.deepseek.com/v1/chat/completions',
    apiKey: 'your-api-key',
    maxRetries: 3,
    retryDelay: 1000
};
```

### 音频配置
```javascript
const AUDIO_CONFIG = {
    backgroundMusic: {
        adventure: { url: 'music/adventure.mp3', volume: 0.3 },
        scifi: { url: 'music/scifi.mp3', volume: 0.3 }
    },
    soundEffects: {
        buttonClick: { url: 'sounds/click.wav', volume: 0.5 }
    }
};
```

### 性能配置
```javascript
const PERFORMANCE_CONFIG = {
    virtualScroll: {
        itemHeight: 60,
        visibleItems: 5,
        bufferSize: 2
    },
    lazyLoad: {
        threshold: 0.1,
        rootMargin: '50px'
    }
};
```

## 🎯 性能指标

- **首屏加载**: < 2秒
- **交互响应**: < 100ms
- **内存使用**: < 50MB
- **音频延迟**: < 50ms
- **缓存命中率**: > 80%

## 🔮 未来计划

- [ ] 角色系统完善
- [ ] 记忆碎片系统
- [ ] 社交分享功能
- [ ] 多语言支持
- [ ] 离线模式
- [ ] 自定义主题

## 📄 许可证

MIT License

## 🤝 贡献

欢迎提交Issue和Pull Request！

---

**VibeStory** - 让每个关键词都成为故事的开始 ✨

## 🎵 音频系统

### 背景音乐
- **智能主题检测**: 根据关键词自动选择最合适的背景音乐
- **风格分类**: 冒险、科幻、奇幻、悬疑、浪漫等不同风格
- **动态切换**: 根据故事内容自动切换主题音乐
- **音量控制**: 独立的主音量和静音控制

### 主题音乐系统
系统包含10种专业主题音乐，每种都有特定的关键词触发：

1. **末日主题** 🌋 - 末日、废墟、灾难、毁灭、末世、废土
2. **机械主题** ⚙️ - 机械、义肢、机器人、齿轮、蒸汽、工业
3. **失忆主题** 🧠 - 失忆、记忆、遗忘、回忆、过去、身份
4. **魔法主题** ✨ - 魔法、法术、咒语、巫师、精灵、龙
5. **战争主题** ⚔️ - 战争、战斗、军队、武器、战场、将军
6. **海洋主题** 🌊 - 海洋、海盗、船只、深海、岛屿、宝藏
7. **太空主题** 🚀 - 太空、宇宙、星球、飞船、星际、外星
8. **古代主题** 🏛️ - 古代、王朝、皇帝、宫殿、历史、传统
9. **现代都市主题** 🏙️ - 都市、城市、现代、科技、商业、生活
10. **自然主题** 🌲 - 自然、森林、山脉、河流、动物、生态

### 智能音乐选择
- **关键词匹配**: 分析用户输入的关键词，自动选择最匹配的主题音乐
- **内容检测**: 实时分析故事内容，动态切换音乐主题
- **优先级系统**: 主题音乐优先于风格背景音乐
- **无缝切换**: 平滑的音乐过渡效果

### 音效系统
- **UI音效**: 按钮点击、页面切换、选择确认等
- **主题音效**: 魔法咒语、剑击声、脚步声、开门声、雷声等
- **环境音效**: 森林、城市、太空、海洋、沙漠、山脉等
- **上下文音效**: 根据故事内容自动播放相关音效

### 音频控制面板
- **音乐信息显示**: 当前播放的音乐类型、名称和描述
- **可视化效果**: 音乐播放时的动态可视化
- **主题建议**: 可点击的主题音乐建议列表
- **播放控制**: 暂停、恢复、停止等基本控制
- **设置保存**: 音频设置自动保存到本地存储

## 🎭 主要功能

### 🎭 故事生成
- **关键词驱动**: 通过输入关键词自动生成个性化故事
- **多风格支持**: 冒险、科幻、奇幻、悬疑、浪漫等多种风格
- **分支剧情**: 智能生成多个故事分支，支持用户选择
- **深度控制**: 可调节故事复杂度（1-10级）

### 🎵 智能音频系统
- **背景音乐**: 根据故事风格自动匹配背景音乐
- **主题音乐**: 基于关键词智能检测并播放主题音乐
- **环境音效**: 根据场景自动播放环境音效
- **音效系统**: 丰富的UI和剧情音效
- **降级方案**: 多重音频源确保播放稳定性

### 📱 移动端适配
- **响应式设计**: 完美适配手机、平板、桌面设备
- **触摸优化**: 针对移动端优化的交互体验
- **侧边栏**: 移动端友好的侧边栏设计
- **性能优化**: 针对移动设备的性能优化

### ⚡ 性能优化
- **音频预加载**: 并发预加载音频文件，支持降级方案
- **懒加载**: 图片和组件懒加载
- **缓存管理**: 智能缓存管理，自动清理过期资源
- **内存管理**: 自动内存监控和清理
- **Service Worker**: 离线缓存和后台同步
- **CDN加速**: 支持CDN资源加速

## 🚀 快速开始

### 环境要求
- 现代浏览器（支持ES6+）
- DeepSeek API密钥（用于故事生成）

### 安装步骤

1. **克隆项目**
   ```bash
   git clone https://github.com/your-username/VibeStory.git
   cd VibeStory
   ```

2. **配置API密钥**
   - 在`script.js`中设置你的DeepSeek API密钥
   - 或通过运行时输入

3. **启动项目**
   ```bash
   # 使用本地服务器（推荐）
   python -m http.server 8000
   # 或
   npx serve .
   ```

4. **访问应用**
   - 打开浏览器访问 `http://localhost:8000`
   - 在设置页面配置故事参数
   - 点击"开始故事"开始创作

## 📖 使用指南

### 创建故事
1. 在设置页面输入故事关键词（用逗号分隔）
2. 选择故事风格（冒险、科幻、奇幻等）
3. 调节复杂度（1-10级）
4. 配置音频设置
5. 点击"开始故事"按钮

### 音频控制
- **背景音乐**: 自动根据故事风格播放
- **主题音乐**: 基于关键词智能匹配
- **环境音效**: 根据场景自动切换
- **音量控制**: 支持主音量和各类型音量调节

### 移动端使用
- **侧边栏**: 点击右上角菜单按钮打开侧边栏
- **音频控制**: 底部固定音频控制面板
- **触摸优化**: 所有按钮都针对触摸进行了优化

## 🛠️ 技术架构

### 前端技术栈
- **HTML5**: 语义化标签和现代HTML特性
- **CSS3**: 响应式设计、动画、深色模式支持
- **JavaScript ES6+**: 模块化、异步编程、Web Audio API
- **Web Audio API**: 音频播放和控制
- **Service Worker**: 离线缓存和后台同步

### 性能优化策略
- **资源预加载**: 关键资源DNS预解析和预连接
- **并发控制**: 音频文件并发预加载，避免阻塞
- **缓存策略**: 多层缓存，智能清理
- **内存管理**: 自动监控和清理
- **懒加载**: 图片和组件按需加载

### 音频系统架构
```
音频配置 → 预加载 → 缓存 → 播放控制 → 降级方案
    ↓         ↓       ↓        ↓         ↓
  主题匹配 → 并发加载 → 内存管理 → 音量控制 → 备用源
```

## 📱 移动端适配

### 响应式断点
- **手机**: < 768px
- **平板**: 768px - 1024px
- **桌面**: > 1024px

### 移动端特性
- **触摸友好**: 最小44px触摸目标
- **字体优化**: 防止iOS缩放
- **侧边栏**: 滑动式侧边栏
- **音频控制**: 固定底部控制面板
- **性能优化**: 针对移动设备的优化

## 🔧 配置选项

### 音频配置
```javascript
const AUDIO_CONFIG = {
    backgroundMusic: {
        adventure: {
            url: 'primary-url',
            fallbackUrl: 'backup-url',
            volume: 0.4,
            loop: true
        }
    },
    // ... 更多配置
};
```

### 性能配置
```javascript
const PERFORMANCE_CONFIG = {
    cache: {
        ttl: 30 * 60 * 1000, // 30分钟
        maxSize: 100
    },
    lazyLoading: {
        threshold: 0.1,
        rootMargin: '50px'
    }
};
```

## 🎯 性能指标

### 加载性能
- **首屏加载**: < 2秒
- **音频预加载**: < 5秒
- **故事生成**: < 10秒

### 运行时性能
- **内存使用**: < 100MB
- **CPU使用**: < 30%
- **音频延迟**: < 100ms

## 🔮 未来计划

### 短期目标
- [ ] 用户自定义音频上传
- [ ] 更多故事风格和主题
- [ ] 社交分享功能
- [ ] 故事收藏和历史记录

### 长期目标
- [ ] 多语言支持
- [ ] 语音朗读功能
- [ ] VR/AR故事体验
- [ ] 多人协作创作

## 🤝 贡献指南

欢迎提交Issue和Pull Request！

### 开发环境设置
1. Fork项目
2. 创建功能分支
3. 提交更改
4. 创建Pull Request

### 代码规范
- 使用ES6+语法
- 添加适当的注释
- 遵循现有代码风格
- 确保移动端兼容性

## 📄 许可证

MIT License - 详见 [LICENSE](LICENSE) 文件

## 🙏 致谢

- **DeepSeek**: 提供AI故事生成API
- **SoundJay**: 提供音频资源
- **Mixkit**: 提供备用音频资源
- **Poppins**: 提供字体支持

## 📞 联系我们

- **项目地址**: [GitHub](https://github.com/your-username/VibeStory)
- **问题反馈**: [Issues](https://github.com/your-username/VibeStory/issues)
- **邮箱**: your-email@example.com

---

⭐ 如果这个项目对你有帮助，请给我们一个Star！