<script>
    function jsonp({url,params={},callback=`callback${+new Date()}`})
    {
        return new Promise((resolve,reject)=>{
            let script = document.createElement('script')
            params = {...params,callback}
            // queryString 的对象
            let arr = []
            for(let key in params)
            {
                arr.push(`${key}=${params[key]}`)
            }
            script.src=`${url}?${arr.join('&')}`
            window[callback] = function(data) {
                resolve(data);
                document.body.removeChild(script); // 添加清理
                delete window[callback]; // 清理全局回调
            };
            script.onerror = function() {
                reject(new Error('JSONP request failed'));
                document.body.removeChild(script);
                delete window[callback];
            };
            document.body.appendChild(script)
        }).then(data=>{
            console.log('Received:', data); // 处理数据
        }).catch(err => {
            console.error('Error:', err); // 错误处理
        });
    }
    jsonp({
        url:'http://localhost:3000/say',
        params:{
           wd: 'I love you'
        },
        callback: 'show'
    }).then(data=>{
        console.log(data)
    })
</script>